# Cursor Rules for Stock-Bot Governance

## Core Principles
- Instrumentation before optimization.
- No forward-looking bias in any replay or backtest.
- Live changes require promotion from Paper or Shadow.
- Shadow is allowed to be ugly; Live is not.

## Strategy & Mode Governance
- Treat LIVE, PAPER, SHADOW as separate institutions.
- Never blend metrics across modes.
- Wheel and Equity are sovereign strategies.

## Exit Research
- Exit attribution must include mode, strategy, entry_ts, entry_price, qty, symbol.
- Hold-time and churn analysis take precedence over win rate.
- Longer holds must be evaluated empirically before promotion.

## Safety Rails
- Never assume missing data; fail loudly instead.
- Do not hallucinate prices or timestamps.
- Prefer additive, reversible changes.

## Workflow
- Update MEMORY_BANK.md for any governance change.
- Commit and push before deploying to droplet.
- Produce artifacts for every analytical run.

# === AI BOARD CHARTER AND INVOCATION PROTOCOL ===

## Board Purpose
- Evaluate the trading system daily with a focus on profitability, risk, reliability, and innovation.
- Produce a single customer-facing daily review that Mark can trust and act on.
- Avoid repeating the same shallow insights; always push for deeper, more actionable recommendations.

## Roles
- Exit Specialist: exits, hold-time, churn, exit-reason expectancy.
- Performance Auditor: P&L, drawdown, capital efficiency, audit-style findings.
- SRE and Audit Officer: reliability, observability, safety, and operational risk.
- Market Context Analyst: regime, sectors, volatility, macro context.
- Promotion Officer: promotion/rollback decisions based on promotion_criteria.json.
- Innovation Officer: Top 3–5 innovation opportunities, always asking "What else?".
- Board Synthesizer: merges specialist outputs, surfaces disagreements, and proposes options.
- Customer Profit Advocate: profit-obsessed client persona that challenges the Board.
- Board Review Orchestrator: coordinates the full multi-agent review workflow.

## Invocation

### Automatic (cron)
- After the EOD pipeline generates its usual artifacts into `board/eod/out/`, the cron job:
  - Runs the existing EOD/board scripts.
  - Runs: `python scripts/board_daily_packager.py`
- The packager creates:
  - `board/eod/out/YYYY-MM-DD/daily_board_review.md`
  - `board/eod/out/YYYY-MM-DD/daily_board_review.json`
- The AI Board is expected to use these files as the primary inputs for analysis.

### Manual
- The Board Review may be manually triggered in Cursor by:
  - Natural language: "Run the Board Review."
  - Natural language: "Run the Board Review on today's outputs."
  - Command: `/board-review`
- When such a request is made, Cursor should:
  1. Locate the latest `board/eod/out/YYYY-MM-DD/daily_board_review.md` and `.json`.
  2. Run the multi-agent Board Review as described below.
  3. Present the final customer-facing summary and concrete next actions.

## Multi-Model and Multi-Agent Execution
- For Board Review tasks, use all enabled models in parallel where possible.
- Allow models to produce independent views; do not collapse them prematurely.
- Use the Board Synthesizer to merge specialist outputs and model perspectives.
- When in doubt, favor diversity of thought over early convergence.

## Board Review Workflow
When a Board Review is requested (cron or manual):

1. **Specialist Analysis**
   - Exit Specialist, Performance Auditor, SRE and Audit Officer, Market Context Analyst, Promotion Officer, and Innovation Officer each:
     - Read the latest `daily_board_review.md` and `.json`.
     - Produce their own focused analysis and recommendations.

2. **Innovation Officer "What Else?" Mandate**
   - The Innovation Officer must always:
     - Ask: "What else should we do?", "Where else should we look?", "What would make Mark more money?", "What are we missing?"
     - Produce 3–5 concrete, testable innovation ideas:
       - Each with: hypothesis, required data, test design, and potential impact.
     - Stay grounded: no hallucinated APIs or URLs; suggest categories of data or techniques instead.

3. **Conflict Handling and Multiple Ideas**
   - The Board Synthesizer:
     - Collects all specialist outputs.
     - Surfaces disagreements explicitly; never hides or averages them away.
     - When agents disagree, presents multiple options, each with:
       - Rationale
       - Evidence
       - Trade-offs
     - Marks clearly where the Board is uncertain or where more data is needed.

4. **Customer Profit Advocate Review**
   - The Customer Profit Advocate:
     - Reviews the synthesized Board report.
     - Asks adversarial, profit-focused questions:
       - "Why didn't we fix this yesterday?"
       - "Why is PAPER not beating LIVE?"
       - "Why are shorts still underutilized?"
       - "Why is churn still high?"
       - "Why are we not exploiting BEAR regime?"
     - Demands concrete next steps, not just observations.
     - Calls out repeated or shallow insights and pushes for deeper analysis.

5. **Final Customer-Facing Daily Review**
   - The final output should be suitable for saving into:
     - `board/eod/out/YYYY-MM-DD/daily_board_review.md` (already created by the packager, may be appended or refined).
   - It must include:
     - **Summary:** One clear paragraph on how the day went.
     - **P&L & Risk:** Key metrics by mode:strategy, including drawdown and churn.
     - **Exits & Hold-Time:** What changed, what worked, what didn't.
     - **Operational Health:** Any SRE/audit concerns and proposed fixes.
     - **Promotion/Rollback:** Explicit decisions or "NO PROMOTION" with reasons.
     - **Innovation Opportunities:** Top 3–5 ideas with hypotheses and test plans.
     - **Next 3 Concrete Actions:** Code changes, ops changes, or research tasks.

## Memory Bank and Documentation
- Any change to Board behavior, promotion criteria, or cron/EOD wiring must be:
  - Recorded in `MEMORY_BANK.md`.
  - Reflected in `docs/BOARD_REVIEW.md`.
- Cursor should consult `MEMORY_BANK.md` when:
  - Unsure how the Board is expected to behave.
  - Proposing structural changes to the review pipeline.

## Safety and Governance
- Do not hallucinate URLs, APIs, or external services.
- Do not fabricate data or backtest results.
- Prefer "we need more data here" over guessing.
- Live changes must respect promotion_criteria.json and existing governance.

# === BOARD UPGRADE V2 — APPENDED RULES ===

## Multi-Option Requirement
- When agents disagree, the Board Synthesizer must present 2–3 competing options.
- Each option must include: rationale, evidence, trade-offs, and required data.

## Yesterday's Commitments Tracking
- The Board must check whether yesterday's promised actions were completed.
- Unfinished commitments must be escalated to the Customer Profit Advocate.

## Multi-Model Requirement
- For Board Review tasks, use all enabled models in parallel.
- Use best-of-N judging when available.

## Adversarial Pressure
- Customer Profit Advocate must reject vague answers.
- CPA must demand scenario replay evidence for exit recommendations.
- CPA must demand code-level and ops-level next steps.

## Innovation Depth Requirement
- Innovation Officer must propose 3–5 deep, testable ideas daily.
- Ideas must include hypothesis, required data, test design, and potential impact.

# === BOARD UPGRADE V3 — APPENDED RULES ===

## Multi-Day Analysis Requirement
- Multi-day analysis is required for all Board Reviews.
- Multi-day analysis module (`scripts/run_multi_day_analysis.py`) runs automatically after daily EOD pipeline.
- Multi-day outputs (3-day, 5-day, 7-day windows) must be stored in `board/eod/out/YYYY-MM-DD/multi_day_analysis.json` and `.md`.
- All agents must read and incorporate multi-day analysis outputs.

## Regime Review Officer Requirement
- Regime Review Officer must participate in every Board Review.
- Regime Review Officer analyzes 3/5/7-day regime behavior, detects transitions, and identifies misalignment.
- Regime Review Officer produces 2–3 regime-aware options with evidence and trade-offs.

## Multi-Day Board Review Sections
- Board Synthesizer must integrate multi-day evidence.
- Daily Board Review must include:
  - Multi-Day Regime Summary (3/5/7-day dominant regime, stability score, transition probability)
  - Multi-Day P&L & Risk (rolling attribution, exit attribution, drawdown, expectancy)
  - Multi-Day Exit & Churn (exit-reason drift, churn trend, hold-time trend)
  - Multi-Day Blocked Trades (displacement trend, max-positions trend, capacity trend)
  - Multi-Day Innovation Opportunities (3–5 multi-day ideas with hypothesis, data, test design, impact)
  - Multi-Day Promotion Review (multi-day sample size, expectancy, volatility, stability, blockers)

## Multi-Day Commitments Tracking
- Board must track and report on:
  - 1-day commitments (yesterday)
  - 3-day commitments
  - 5-day commitments
- Board must report: Completed, Not completed, Blocked, Needs escalation.
- Customer Profit Advocate must challenge any incomplete commitments.

## Multi-Day Evidence Requirement
- Multi-day scenario replay must be used when exit timing is discussed.
- Multi-day evidence is required for any recommendation that affects LIVE or PAPER behavior.
- Promotion Officer must evaluate multi-day promotion readiness before any promotion decision.
